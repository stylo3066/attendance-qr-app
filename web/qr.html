<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QR de Profesor</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; color: #0f172a; }
      .card { max-width: 520px; margin: 0 auto; padding: 16px; border: 1px solid #e2e8f0; border-radius: 12px; background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
      h1 { font-size: 20px; margin: 0 0 8px 0; }
      .row { display: flex; gap: 8px; margin: 10px 0 16px; }
      input { flex: 1; padding: 10px 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; }
      button { padding: 10px 14px; border: 0; border-radius: 8px; background: #2563eb; color: #fff; cursor: pointer; font-weight: 600; }
      button.secondary { background: #0ea5e9; }
      button:disabled { opacity: .6; cursor: not-allowed; }
      .preview { display: grid; place-items: center; background: #fff; padding: 12px; border: 1px dashed #cbd5e1; border-radius: 12px; }
      .hint { color: #475569; font-size: 12px; margin-top: 8px; }
      footer { text-align: center; margin-top: 16px; color: #64748b; font-size: 12px; }
    </style>
    <!-- QRCode.js (MIT) de Kazuhiko Arase vía CDN -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  </head>
  <body>
    <div class="card">
      <h1>Generador de QR (Profesor)</h1>
      <p>Introduce el ID del profesor (ej.: <code>PROF_001</code>) y genera el QR listo para descargar.</p>
      <div class="row">
        <input id="text" type="text" placeholder="PROF_001" />
        <button id="btnGen" class="secondary">Generar</button>
      </div>
      <div class="preview">
        <div id="qrcode"></div>
      </div>
      <div class="row" style="margin-top:16px; justify-content: space-between;">
        <span class="hint">Consejo: usa IDs coherentes con tu app (p.ej. PROF_002, PROF_MAT, etc.).</span>
        <button id="btnDown">Descargar PNG</button>
      </div>
      <footer>
        Tip: también puedes usar la app publicada para generar y descargar QR desde el botón con icono QR.
      </footer>
    </div>

    <script>
      const qs = new URLSearchParams(location.search);
      const input = document.getElementById('text');
      const qrcodeEl = document.getElementById('qrcode');
      const btnGen = document.getElementById('btnGen');
      const btnDown = document.getElementById('btnDown');

      const initial = (qs.get('t') || 'PROF_001').trim();
      input.value = initial;

      let qrcode;
      function render(text){
        qrcodeEl.innerHTML = '';
        qrcode = new QRCode(qrcodeEl, {
          text: text,
          width: 256,
          height: 256,
          correctLevel: QRCode.CorrectLevel.M
        });
      }

      btnGen.addEventListener('click', () => {
        const v = input.value.trim();
        if (!v) return;
        render(v);
      });

      btnDown.addEventListener('click', () => {
        // QRCodeJS puede renderizar como img o canvas; intentamos capturar el canvas/img generado.
        const img = qrcodeEl.querySelector('img');
        const canvas = qrcodeEl.querySelector('canvas');
        const filename = (input.value.trim() || 'qr') + '.png';
        if (canvas) {
          const url = canvas.toDataURL('image/png');
          download(url, filename);
        } else if (img && img.src) {
          download(img.src, filename);
        }
      });

      function download(url, filename){
        const a = document.createElement('a');
        a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
      }

      // Render inicial
      render(initial);
    </script>
  </body>
  </html>
